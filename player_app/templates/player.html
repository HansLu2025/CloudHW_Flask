{% extends "base.html" %}
{% block title %}球員詳細{% endblock %}

{% block content %}
<a href="{{ url_for('index') }}" class="btn btn-secondary mb-3">← 回到球員列表</a>

<div id="card" class="card shadow-sm">
  <div class="card-body">
    <h3 id="name" class="card-title mb-3">載入中...</h3>
    <p><strong>球隊：</strong> <span id="team"></span></p>
    <p><strong>守備位置：</strong> <span id="position"></span></p>
    <p><strong>打擊率：</strong> <span id="batting"></span></p>
    <hr>
    <h5>球員簡介</h5>
    <p id="bio"></p>
    <div class="mt-4 d-flex gap-2">
      <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">回列表</a>
      <a id="editBtn" class="btn btn-primary">編輯球員</a>
      <button id="deleteBtn" class="btn btn-danger">刪除球員</button>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
const playerId = {{ player_id|int }};

async function loadPlayer() {
  const res = await fetch(`/api/players/${playerId}`);
  if (res.status === 404) {
    document.getElementById('card').innerHTML = '<div class="card-body"><div class="alert alert-danger">找不到該球員。</div></div>';
    return;
  }
  const p = await res.json();
  document.getElementById('name').textContent = p.name;
  document.getElementById('team').textContent = p.team;
  document.getElementById('position').textContent = p.position;
  document.getElementById('batting').textContent = Number(p.batting_avg).toFixed(3);
  document.getElementById('bio').textContent = p.bio;

  document.getElementById('editBtn').href = `/players/${p.id}/edit`;
}

async function deletePlayer() {
  if (!confirm('確定要刪除這位球員嗎？')) return;
  const res = await fetch(`/api/players/${playerId}`, { method: 'DELETE' });
  if (res.ok) {
    toast('刪除成功');
    window.location.href = '/';
  } else {
    const err = await res.json().catch(() => ({}));
    toast(err.error || '刪除失敗');
  }
}

document.getElementById('deleteBtn').addEventListener('click', deletePlayer);

loadPlayer();
</script>
{% endblock %}
